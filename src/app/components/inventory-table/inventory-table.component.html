<!-- angular-inventory-app/src/app/components/inventory-table/inventory-table.component.html -->
<div class="text-card-foreground bg-card rounded-lg shadow-lg border">
  <div class="flex flex-col p-6 space-y-1.5">
    <div class="flex flex-col items-start justify-between gap-4 sm:flex-row">
      <div>
        <!-- Aqui iria un app card title -->
        <div class="text-2xl font-semibold leading-none tracking-tight">
          <div class="font-semibold tracking-tight font-headline text-2xl">Inventario de Equipos de TI</div>
        </div>
      </div>
      <!-- Aqui iria un app add equipment form -->      
      <app-add-equipment-form (equipmentAdded)="handleEquipmentAdded($event)"></app-add-equipment-form>

    </div>
    <div class="flex flex-col items-start justify-between gap-4 sm:flex-row">
      <div class="relative w-full md:flex-grow">
        <!-- Assuming lucide-angular provides a way to use icons directly or via a component -->
        <lucide-icon [img]="searchIcon"
          class="absolute left-1 top-1/2 h-4 w-4 text-muted-foreground -translate-y-1/2"></lucide-icon>
        <input placeholder="Buscar por modelo, serie, ubicación..."
          class="flex px-3 py-2 placeholder:text-muted-foreground pl-9 h-10 w-full text-sm bg-background rounded-md border-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          [value]="(inventoryService.searchTerm$ | async)" (input)="onSearchTermChange($event)" />
      </div>
      <div class="flex gap-4 w-full md:flex-grow">
        <select title="Equipos" class="flex items-center justify-between px-3 py-2 placeholder:text-muted-foreground h-10 w-full text-sm bg-background rounded-md border-input border ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 md:w-[200px]"
          width="800px"
          [value]="(inventoryService.typeFilter$ | async)" (change)="onTypeFilterChange($any($event.target).value)">
          <option value="all">Todos los Tipos</option>
          <option *ngFor="let type of EQUIPMENT_TYPES" [value]="type">{{ type }}</option>
        </select>
        <select class="flex items-center justify-between px-3 py-2 placeholder:text-muted-foreground h-10 w-full text-sm bg-background rounded-md border-input border ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 md:w-[200px]"
          [value]="(inventoryService.statusFilter$ | async)" (change)="onStatusFilterChange($any($event.target).value)">
          <option value="all">Todos los estados</option>
          <option *ngFor="let status of EQUIPMENT_STATUSES" [value]="status">{{ status }}</option>
        </select>
      </div>
    </div>
  </div>
  <div class="p-6 pt-0">
    <div class="overflow-auto rounded-lg border-gray-200 border">
      <table class="min-w-full text-sm divide-y divide-gray-200">
        <thead class="text-white text-xs bg-imss-verde uppercase">
          <tr>
            <th class="w-[80px]">Tipo</th>
            <th>Modelo</th>
            <th>No. Serie</th>
            <th>Ubicación</th>
            <th>Asignado a</th>
            <th>Estado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          <ng-container *ngIf="(filteredInventory$ | async) as filteredInventory">
            <ng-container *ngIf="filteredInventory.length > 0; else noResults">
              <tr *ngFor="let item of filteredInventory">
                <td>
                  <div class="flex items-center gap-2">
                    <lucide-icon [img]="iconMap[item.type]"></lucide-icon>
                    <span class="font-medium">{{ item.type }}</span>
                  </div>
                </td>
                <td>{{ item.model }}</td>
                <td>
                  <!-- este app-badge ya lo tengo hecho, luego te paso el codigo -->
                  <app-badge variant="secondary">{{ item.serialNumber }}</app-badge>
                </td>
                <td>{{ item.location }}</td>
                <td>{{ item.assignedTo || "N/A" }}</td>
                <td>
                  <app-badge variant="outline" class="flex items-center gap-2 w-fit">
                    <span [ngClass]="cn('h-2 w-2 rounded-full mr-2', statusConfig[item.status].color)"></span>
                    <span>{{ statusConfig[item.status].label }}</span>
                  </app-badge>
                </td>
                <td class="text-right">
                  <!-- Aqui iria el app-dropdown-menu, se aceptan sugerencias -->
                  <div class="relative inline-block text-left">
                    <button (click)="selectedItemId = item.id" class="hover:text-imss-verde">
                      <lucide-icon [img]="moreHorizontalIcon" class="h-4 w-4"></lucide-icon>
                    </button>
                    <div *ngIf="selectedItemId === item.id"
                      class="z-10 absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg origin-top-right ring-1 ring-black ring-opacity-5 focus:outline-none">
                      <div class="py-1">
                        <button class="block px-4 py-2 w-full text-sm text-gray-700 hover:bg-gray-100"
                          *ngFor="let status of EQUIPMENT_STATUSES" (click)="handleStatusUpdate(item.id, status)">
                          Cambiar a {{ statusConfig[status].label }}
                        </button>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
            <ng-template #noResults>
              <tr>
                <td [attr.colSpan]="7" class="h-24 text-center">
                  No se encontraron resultados.
                </td>
              </tr>
            </ng-template>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>